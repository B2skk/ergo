\documentclass[]{article}
\RequirePackage{amsmath}

\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{color}
\usepackage{hyperref}
\usepackage{float}
\usepackage{algorithm}
\usepackage{algpseudocode}

\bibliographystyle{IEEEtran}

\newcommand{\knote}[1]{{\textcolor{green}{Alex notes}}{#1}}
\newcommand{\dnote}[1]{{\textcolor{red}{DNotes:{#1}}}}
\newcommand{\Ergo}{Ergo}
\newcommand{\Erg}{\textbf{Erg}}
\newcommand{\nanoErg}{\textbf{nanoErg}}
\def\Let#1#2{\State #1 $:=$ #2}
\def\LetRnd#1#2{\State #1 $\gets$ #2}

\begin{document}
    \title{Ergo: The Resilient Platform For Contractual Money}
    %    \author{Dmitry Meshkov}

    %    \date{January 25, 2019\\v1.0}

    \maketitle

    \begin{abstract}
        \dnote{todo}
    \end{abstract}

    %    #######################################################################################
    %    Базовые мысли:
    %
    %    Основные фичи - децентрализация и контракционные деньги
    %    Изначальные пользователи - фанаты децентрализации кто уже более-менее в теме, и устали от проблем BTC/ETH (пример - Justin, mx)
    %
    %    #######################################################################################


    \section{Introduction}

    %    Блокчейн дает безопасность (resilient), которая следует из децентрализации (на разных уровнях - майнеры, разработчики, легкие клиенты). (Bitcoin and its problems?)
    %    Безопасность идет высокой ценой (синхронизация и процессинг данных на куче компов), поэтому основное применение - денежное (Money)
    %    Для активного применения (platform) нужна адаптивность под окружение (голосование, выживаемость и т.д.) и возможности написания финансовых контрактов (Contractual)
    %    Вот это все в Эрго, лучше чем в Эфириуме и Биткоине.

    Started more ten years ago with the Bitcoin~\cite{nakamoto2008bitcoin}, blockchain technology proved to be a secure way on maintaining
    a public transaction ledger.
    Even after achieving a market capitalisation over \$300bn in 2017~\cite{btcPrice}
    no serious attacks were performed to the Bitcoin network\dnote{check} despite the high yield of a successful attack.
    At the same time, centralized services are continuously fails to resist attacks, regardless of a maintaining company size and expertize.
    \dnote{examples of attacks to crypto exchanges (mt. gox?), big companies (Facebook? Or better some bank), malicious or incompetent behaviour of some human.
    Discuss a bit more if there are good examples especially of the last point}.
    This outstanding resilience of cryptocurrencies is achieved by a combination of modern cryptographic algorithms like digital
    signatures, that are widely adapted outside cryptocurrencies space, and decentralization, that is ensures that only
    the majority of the network participants can affect its security.

    However, this resilience does not come for free.
    To use a blockchain without any trust, it's participants should download and process all the transactions in
    the network, utilizing network resources.
    Besides network utilization, transaction processing requires to spend some computational resources,
    especially if transactional language is flexible enough.
    Finally, blockchains participants should keep quite big amount of data in their local storages and
    this storage requirements are growing fast.
    Thus thousands of computers all over the world utilize various resources
    increasing the cost of single transaction processing,
    and users pay transaction fees~\cite{chepurnoy2018systematic} to prevent spam attacks and
    to encourage participation in the protocol.
    These fees may be very high during the high load~\cite{bitcoinFees},
    and ten years later blockchain technology is still mainly used in a money application, where the advantage of
    high security outweighs the disadvantage of high transaction costs.

    Besides of a plain currency usage, most of blockchains are used to build decentralized applications on top of them.
    Such applications utilize the ability to write smart contracts~\cite{szabo1994smart}, that implements their logic
    by means of blockchain-specific programming language.
    Ways to write smart contracts depends on cryptocurrency transactional model~\cite{zahnentferner2018chimeric} ---
    in UTXO-based cryptocurrencies like Bitcoin~\cite{nakamoto2008bitcoin} every coin is protected by a used-defined script,
    while in account-based cryptocurrencies like Ethereum~\cite{ethWhitepaper} transactions call a code from special contract accounts.
    While this models are equivalent \dnote{correct word here?}, protecting scripts implementation is not so natural for
    account model~(e.g. simple multi-signature contract bug led to \$150 million loss in 2017 in Ethereum~\cite{parityLock}),
    while arbitrary Turing-complete logic implementation may be tricky in UTXO model~(e.g. check this example of
    simple Turing-complete system implementation in \Ergo{}~\cite{chepurnoy2018self}).

    While contractual component is attractive in terms of building decentralized applications,
    it is also important that the blockchain will survive in a long term.
    For now the whole area is young and most of application-oriented blockchain platforms exists just for several years,
    while they already have known problems with performance degradation over time \dnote{links and may be more discussion of known problems}
    and their long-term survivability is questionable.
    This problem led to concepts of lightened nodes with minimum storage requirements~\cite{reyzin2017improving},
    storage rent fee component that prevents bloating of full-node requirements~\cite{chepurnoy2018systematic},
    self-amendable protocols that can adopt to changing environment and improve themselves without
    trusted parties~\cite{goodman2014tezos}, and more.

    The main goal of the Ergo platform is to solve these problems by implementing known scientific ideas.
    It may be called a ``blockchain 1.1'' implementation --- a major update to
    blockchain technology instead of revolutionary breaking changes.
    The objective of Ergo is to be the platform for blockchain-demanding decentralized
    applications, survivable in the long-term and reliable to external or internal threats.
    In the following sections we summarize the general design of Ergo, it's technical and economic solutions,
    as well as provide possible examples of it's use-cases and further development.

    \section{Social contract}
    \label{sec:social}

    \Ergo{} protocol is very flexible and may be changed in the future by the community.
    In this section we define the main principles, that should be followed during the \Ergo{} protocol updates.
    In case of intentional violation of any of these principles, the resulting protocol should not
    be called \Ergo{}.

    \begin{itemize}
        \item{\em Decentralization first.} \Ergo{} should be as decentralized as possible.
        This means that any parties (social leaders, software developers, hardware manufacturers, miners and so on)
        which absence or malicious behaviour may affect the security of the network should be avoided.
        In particular, this means that treasury funds~(see \ref{sec:currency}) should be distributed
        in decentralized manner after the initial 1 year period.
        \item{\em Created for regular people.} \Ergo{} is the platform for regular people, their interests should
        not be infringed upon in favor of big players. In particular, that means that they should be able to
        participate in the protocol by running a full node and mine blocks (with small probability).
        \item{\em Platform for Contractual money.} \Ergo{} is the base layer to applications, that will be
        build on top of it. It allows to implement any kind of applications, but it's main goal is
        to provide efficient, secure and easy way to implement financial contracts. \dnote{probably kushti may write this better}
        \item{\em Long terms focus.} All aspects of \Ergo{} development should be focus on long-term perspective.
        At any point of time, \Ergo{} should be able to survive for centuries without expected hardforks,
        software or hardware improvements or some other unpredictable changes. As far as \Ergo{} is oriented
        to be a platform, applications built on top of \Ergo{} should also be able to survive in a long term.
        \item{\em Permissionless and open.} \Ergo{} protocol does not restrict or limit any categories of usage.
        It should allow anyone to join the network and participate the protocol without any preliminary permissions.
        No bailouts, blacklists or other forms of discrimination should be possible on core level of \Ergo{} protocol.
        On the other hand application developers are free to implement any logic they want, taking responsibility
        for the ethics and legality of their application.
    \end{itemize}


    \section{Autolykos Consensus Protocol}
    \label{sec:autolykos}

    %   Почему выбрали PoW
    %   Известные проблемы PoW
    %   Детали Автоликуса

    The core component of any blockchain system is it's consensus protocol.
    Despite of an extensive research of possible alternatives to original the Proof-of-Work (PoW) protocol,
    it remains in demand due to simplicity, high security guaranties and friendliness to light clients.
    However, decade of extensive testing revealed several problems of the original one-CPU-one-vote idea.

    First known problem of PoW is that development of a specialized hardware (ASIC) allowed
    small group of ASIC-equipped miners to solve PoW puzzles orders of magnitude faster and more efficiently
    than everyone else. This problem can be solved with the help of memory-hard PoW schemes,
    that reduce the disparity between the ASICs and commodity hardware. Most promising approach here
    is to use asymmetric memory-hard PoW schemes that require significantly less memory
    to verify a solution than to find it where proposed~\cite{biryukov2017equihash,ethHash}.

    Second known threat to a PoW network decentralization, is that even big miners trend to unite in
    mining pools, leading to a situation when just few pool operators (5 in Bitcoin, 2 in Ethereum
    at the time of writing) controls more then 51\% of computational power.
    Although the problem has already been discussed in the community, no practical solutions were
    implementer before \Ergo{}.


    Ergo PoW protocol --- Autolykos --- is the first consensus protocol, that is both memory hard
    and pool resistant~\cite{Ergopow}.
    Autolykos is based on one list $k$-sum problem: miner should find
    $k=32$ elements from the pre-defined list $R$ of size $N=2^{26}$~(which have a size of 2 Gb),
    such that $\sum_{j \in J} r_{j} - sk = d$ is in the interval $\{-b,\dots,0,\dots,b\mod q\}$.
    Elements of list $R$ are obtained as a result of one-way computation from index $i$,
    two miner public keys $pk,w$ and hash of block header $m$ as $r_i=H(i||M||pk||m||w)$,
    where $M$ is a static big message that is used to make hash calculation slower.
    In addition, we require set of element indexes $J$ to be obtained
    by one-way pseudo-random function $genIndexes$, that prevents possible solutions
    search optimizations.

    Thus we assume that the only option for miner is to use the simple brute-force algorithm~\ref{alg:prove} to
    create a valid block.

    \begin{algorithm}[H]
        \caption{Block mining}
        \label{alg:prove}
        \begin{algorithmic}[1]
            \State \textbf{Input}: latest block header hahs $m$, key pair $pk=g^{sk}$
            \State Generate randomly a new key pair $w=g^x$
            \State Pre-calculate list $R$ where $r_i=H(j||M||pk||m||w)$
            \While{$true$}
            \LetRnd{$nonce$}{$\mathsf{rand}$}
            \Let{$J$}{$genIndexes(m||nonce)$}
            \Let{$d$}{$\sum_{j \in J}{r_j} \cdot x - sk \mod q$}
            \If{$d < b$}
            \State \Return $(m,pk,w,nonce,d)$
            \EndIf
            \EndWhile
        \end{algorithmic}
    \end{algorithm}

    Note that although the mining process utilizes private keys, solution itself
    only contains public keys. Solution verification can be performed by Alg.~\ref{alg:verify}.

    \begin{algorithm}[H]
        \caption{Solution verification}
        \label{alg:verify}
        \begin{algorithmic}[1]
            \State \textbf{Input}: $m,pk,w,nonce,d$
            \State require $d < b$
            \State require $pk,w\in \mathbb{G}$ and $pk,w \ne e$
            \Let{$J$}{$genIndexes(m||nonce)$}
            \Let{$f$}{$\sum_{j \in J} H(j||M||pk||m||w)$}
            \State require $w^f = g^dpk$
        \end{algorithmic}
    \end{algorithm}

    Target parameter $b$ is adjusted to the current network hashrate via difficulty adjustment
    algorithm~\cite{meshkov2017short}, that is trying to predict an upcoming 1024 block length
    epoch hashrate based on data from previous 8 epochs.
    Full technical specification of Autolykos may be found at~\cite{Ergopow}.

    \section{Survivability}
    \label{sec:survivability}

    %   well-tested solutions
    %   voting
    %   soft-forkability
    %   storage rent
    %   light clients (Пробелмы пользователей без легких клиентов, Дайджест узлы, nipopow/flight clients)

    Being a platform for contractual money, Ergo should also support long-term contracts for a
    period of a person's life.
    While even young project are experiencing issues with the performance degradation and
    adaptability to external conditions, leading to a situation when a decentralized cryptocurrency
    depends on a small group of developers, that should provide a hard-fork, otherwise the cryptocurrency
    won't survive.

    First common issue is that in pursuit of popularity blockchain developers implement ad-hoc
    solutions without proper preliminary research and testing.
    Such solutions inevitably lead to bugs, and regardless of whether they were exploited or not
    to bug fixes in a centralized manner, that makes the network even less secure.
    Ergo approach here is to use stable well-tested solutions, even if that leads to slower
    short-term innovation applicability.
    Most of Ergo solutions are formalized in scientific papers, presented at peer-reviewed conferences
    and are widely discussed in community.

%    storage fee should be here, as soon as we use it in the next section as an example

    Another important aspect of survivability, is that the environment changes and a blockchain should
    adopt to changing hardware infrastructure, appearing ideas that may improve security or
    scalability, arising use-cases and so on.
    If all the rules are fixed without any ability to change them in a decentralized manner, even
    simple constant change may lead to huge debates and community split, e.g. discussion of a block
    size limit in Bitcoin led to the network split into several independent coins.

    In contrast, Ergo protocols is self-amendable and is able to adopt to changing environment.
    In Ergo parameters like block size can be changed on-the-fly via miners voting.
    At the beginning of a 1024 blocks length voting epoch miner is proposing changes~(up to 2 parameters,
    e.g. to increase block size and to decrease storage fee factor) and during the rest of epoch miners
    vote, whether to approve these changes or not.
    If majority of votes within an epoch are supporting some~(or both) of these changes, a new value of the
    parameter should be written into the extension section of the first block of the next epoch and the
    network starts to use this update parameter value during block mining and validation.

    To absorb more fundamental changes, Ergo is following the approach of soft-forkability, that
    allows to change protocol significantly but keeping old nodes operating.
    At the beginning of an epoch, miner can also propose to vote for a fundamental change~(e.g.~to
    add new instruction to ErgoScript), describing affected validation rules.
    Voting for such breaking changes continues for 32768 blocks and requires at least $90\%$ of
    "Yes" votes to be accepted.
    Once being accepted, 32768 blocks length activation period started to give time to outdated
    nodes to update their software version, and after that changes are activated.
    If a node is still not updated after the activation period, it skips the specified checks,
    but continues to validate all the known rules.
    List of previous soft-fork changes is record into the extension to allow light nodes of
    any software version to join the network and read validation rules, it should not check.





    \section{Currency And Emission}
    \label{sec:currency}

    %    подробная информация об эмиссии, скрипту эмиссии, и всему-всему что нужно для фаундейшена

    The native currency of \Ergo{} platform is \Erg{} token, which unique property is
    that it is the only currency to pay storage rent in \Ergo{}~(see~\ref{sec:economy} for more details).
    One \Erg{} token is divisible to up to $10^9$ parts labeled as \nanoErg{}.

    All \Erg{} tokens that will ever be circulate in the system are presented in the
    initial state and are divided in 3 parts~(boxes):

    \begin{itemize}
        \item{\em No premine proof.} This box contain exactly one~\Erg{} and is protected by the script,
        that is preventing it from spending by anyone.
        Thus, it is a long-living box, that will live in the system until storage-rent component will
        destroy it.
        It's main purpose is to prove, that \Ergo{} mining was not started privately by anyone before
        the declared launch date.
        To achieve this, additional registers of this box contains news from media (Guardian, Xinhua, Vedomosti)
        and block ids from already established cryptocurrencies (Bitcoin and Ethereum).
        Thus, \Ergo{} mining could not be started before certain events in the real world and in
        cryptocurrency space.

        \item{\em Treasury.} This box contain 4330791.5 \Erg{} that will be used to fund \Ergo{}
        development.
        It's protecting script~\cite{link to corresponding ergo tree} consists of two parts.

        First, it ensures, that only predefined portion of the box value was taken.
        During blocks 1-525599 (2 years) 7.5 \Erg{} will be released every block,
        during blocks 525600-590399 (3 month) 4.5 \Erg{} will be released every block and finally
        during blocks 590400-655199 (3 month) 1.5 \Erg{} will be released every block.
        This rule ensures the presence of funds for \Ergo{} development for at least 2.5 years and
        prevents an excessive wealth concentration under control of small group of people, as soon
        as at any point of time it won't exceed 10\% of total number of coins in circulation.

        Second, it have a custom protection from unexpected spending.
        Initially it requires that spending transaction should be signed by at least 2 of 3 secret keys,
        that are under control of initial team members. When they spend this box, they are free to
        change this part of the script as they wish, for example by adding new members to protect foundation
        funds or switching to threshold by special token ownership~\cite{link to ...}.

        During the first year this funds will be used to cover pre-issued EFYT token~\cite{our website},
        after that they will be distributed in decentralized manner via community voting.


        \item{\em Miners reward.} This box contain 93409132 \Erg{} that will be collected by block miners
        as a reward of their work.
        It's protecting script~\cite{link to corresponding ergo tree} have several conditions.

        First it checks, that block reward is going to the exact miner, that solved the PoW puzzle, and
        may be spent not earlier than 720 blocks after the current block.
        This restrictions are done to prevent mining pools formation, see~\ref{sec:autolykos} for more details.

        Second, it ensures, that only predefined portion of the box value was taken.
        During blocks 1 - 525599 (2 years) miner will be able to collect 67.5 \Erg{} from this box,
        during blocks 525600 - 590399 (3 month) miner will be able to collect 66 \Erg{} and after
        that block reward will be reduced for 3 \Erg{} every 64800 blocks (3 months) until it will reach zero
        at block 2080799, that should happen roughly 8 years after the genesis block.


    \end{itemize}

    All these rules results in the following curve of efficient number of coins in circulation with time:

    \dnote{TODO: plot the correct emission curve - number of \Erg{} in circulation vs time. Miners and foundation part, like ZCash https://z.cash/blog/funding/}


    \section{Contractual Money}
    \label{sec:contractual}

    %   пишет Саша

    %   ценность нашего токена, и филосовские размышления о данном типе экономики
    %   практические удобные и эффективные контракты для денег
    %   Описать про UTXO модель, почему мы ее выбрали
    %   Скрипт - доступ к стейту, доступ к блокчейну, цепочки (тут можно сослаться на Эфир, ибо там написано что в UTXO это невозможно), сигма протоколы
    %   token system - токены на базовом уровне, сильно упрощают протоколы вида "token threshold", позволяют разграничить потоки
    %   ? Анонимность и пример контракта миксинга
    %   Примеры 1-2 контракта, который иллюстрируют несколько основных преимуществ эрго

    \section{Conclusions}

    \bibliography{references}

\end{document}
